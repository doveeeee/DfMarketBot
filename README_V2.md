# DFMarketBot 使用文档

## 项目概述

DFMarketBot 是专为三角洲行动游戏设计的自动化市场工具，通过图像识别和模拟操作实现自动购买功能。

## 功能特点

- ✅ 支持屯仓模式和滚仓模式
- ✅ 钥匙卡模式独立配置
- ✅ 毫秒级循环间隔控制
- ✅ 多种分辨率自动适配
- ✅ 实时配置热更新
- ✅ 统一异常处理

## 文件结构

```
DFMarketBot/
├── DFMarketBotV2.py          # 主程序入口
├── config/
│   └── settings.json         # 配置文件
├── src/                      # 核心代码
├── GUI/                      # UI界面文件
│   ├── AppGUI.py
│   └── AppGUI.ui
└── requirements.txt          # 依赖列表
```

## 使用方法

### 1. 安装依赖

确保已安装所有依赖：

```bash
pip install -r requirements.txt
```

### 2. 运行程序

```bash
python DFMarketBotV2.py
```

### 3. 配置说明

配置文件位于 `config/settings.json`：

```json
{
  "trading_mode": 0,           // 0=屯仓模式, 1=滚仓模式
  "rolling_option": 0,         // 滚仓模式选项 (0-3)
  "ideal_price": 1000,         // 理想价格
  "max_price": 2000,           // 最高价格
  "loop_interval": 50,         // 循环间隔(毫秒)
  "item_type": 0,              // 0=可兑换, 1=不可兑换
  "key_mode": false,           // 是否钥匙卡模式
  "use_balance_calculation": false,  // 是否使用余额计算
  "screen_width": 2560,        // 屏幕宽度
  "screen_height": 1440,       // 屏幕高度
  "tesseract_path": "",        // Tesseract路径(可选)
  "log_level": "INFO"          // 日志级别
}
```

### 4. 操作说明

#### 屯仓模式 (模式0)
- **功能**: 在交易页面自动购买物品
- **策略**: 
  - 价格 ≤ 理想价格：购买200发
  - 价格 > 理想价格：刷新31发
  - 钥匙卡模式：购买1张后停止（需勾选钥匙卡模式）

#### 滚仓模式 (模式1)
- **功能**: 在配装页面自动购买配装
- **配装选项**: 4个预设配装选项
- **策略**: 根据预设价格区间自动购买

#### 热键
- **F8**: 开始交易
- **F9**: 停止交易

## 高级配置

### 性能调优
- **循环间隔**: 建议50-200毫秒，过低可能影响游戏性能
- **分辨率适配**: 自动适配不同屏幕分辨率
- **日志级别**: 开发时可设为DEBUG，生产环境建议INFO

## 故障排除

### 1. OCR识别失败

- 检查Tesseract是否正确安装
- 确认配置文件中的路径正确
- 检查游戏分辨率设置

### 2. 屏幕捕获失败

- 确认游戏窗口在前台
- 检查屏幕分辨率设置
- 以管理员身份运行程序

### 3. 热键冲突

- 检查游戏内快捷键设置
- 修改热键配置

## 性能优化

### 1. 分辨率适配

系统会自动根据屏幕分辨率缩放坐标，支持多种分辨率：
- 2560x1440 (基准)
- 1920x1080
- 其他分辨率自动适配

### 2. 性能调优

- 调整 `loop_interval` 控制检查频率
- 使用余额计算减少不必要的检测
- 优化OCR识别参数


## 注意事项

1. **管理员权限**: Windows系统可能需要管理员权限
2. **游戏窗口**: 确保游戏窗口在前台且未被最小化
3. **分辨率**: 确保游戏分辨率与系统设置匹配
4. **热键冲突**: 避免与游戏内快捷键冲突

## 技术支持

如遇到问题，请检查：
1. 配置文件是否正确
2. 依赖是否完整安装
3. 游戏窗口是否在前台
4. 系统权限是否足够

## 更新日志

### 最新版本 (2025-08-05)
- ✅ 钥匙卡模式独立配置
- ✅ 毫秒级循环间隔控制
- ✅ 窗口大小优化
- ✅ UI交互改进
- ✅ 配置管理增强